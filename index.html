<!doctype html>
<html lang="en" data-bs-theme="auto">
<head><script src="https://getbootstrap.com/docs/5.3/assets/js/color-modes.js"></script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.122.0">
    <title>Urban Mobility Group</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/5.3/examples/carousel/">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">

    <link href="css/bootstrap.min.css" rel="stylesheet">

    <link rel="apple-touch-icon" href="/docs/5.3/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" href="/docs/5.3/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="/docs/5.3/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
    <link rel="manifest" href="/docs/5.3/assets/img/favicons/manifest.json">
    <link rel="mask-icon" href="/docs/5.3/assets/img/favicons/safari-pinned-tab.svg" color="#712cf9">
    <link rel="icon" href="/docs/5.3/assets/img/favicons/favicon.ico">
    <meta name="theme-color" content="#712cf9">


    <style>
        * {
            border-radius: 0 !important;
        }

        .marketing a{
            text-decoration: none !important;
        }

        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }

        .b-example-divider {
            width: 100%;
            height: 3rem;
            background-color: rgba(0, 0, 0, .1);
            border: solid rgba(0, 0, 0, .15);
            border-width: 1px 0;
            box-shadow: inset 0 .5em 1.5em rgba(0, 0, 0, .1), inset 0 .125em .5em rgba(0, 0, 0, .15);
        }

        .b-example-vr {
            flex-shrink: 0;
            width: 1.5rem;
            height: 100vh;
        }

        .bi {
            vertical-align: -.125em;
            fill: currentColor;
        }

        .nav-scroller {
            position: relative;
            z-index: 2;
            height: 2.75rem;
            overflow-y: hidden;
        }

        .nav-scroller .nav {
            display: flex;
            flex-wrap: nowrap;
            padding-bottom: 1rem;
            margin-top: -1px;
            overflow-x: auto;
            text-align: center;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }

        .btn-bd-primary {
            --bd-violet-bg: #712cf9;
            --bd-violet-rgb: 112.520718, 44.062154, 249.437846;

            --bs-btn-font-weight: 600;
            --bs-btn-color: var(--bs-white);
            --bs-btn-bg: var(--bd-violet-bg);
            --bs-btn-border-color: var(--bd-violet-bg);
            --bs-btn-hover-color: var(--bs-white);
            --bs-btn-hover-bg: #6528e0;
            --bs-btn-hover-border-color: #6528e0;
            --bs-btn-focus-shadow-rgb: var(--bd-violet-rgb);
            --bs-btn-active-color: var(--bs-btn-hover-color);
            --bs-btn-active-bg: #5a23c8;
            --bs-btn-active-border-color: #5a23c8;
        }

        .bd-mode-toggle {
            z-index: 1500;
        }

        .bd-mode-toggle .dropdown-menu .active .bi {
            display: block !important;
        }

         #map { height: 600px; width: 100%; }

        .controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background-color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 999;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
                .marker {
            position: relative;
            width: 20px;
            height: 20px;
            background: #4285f4;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            cursor: pointer;
        }

        .pulse {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background: rgba(66, 133, 244, 0.3);
            border-radius: 50%;
            animation: pulse 2s ease-out infinite;
        }

        @keyframes pulse {
            0% {
                width: 20px;
                height: 20px;
                opacity: 1;
            }
            100% {
                width: 60px;
                height: 60px;
                opacity: 0;
            }
        }

        /* Custom popup styling for Leaflet */
        .custom-popup .leaflet-popup-content-wrapper {
            background: white;
            border: 1px solid #ddd;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .custom-popup .leaflet-popup-content {
            margin: 20px;
            min-width: 250px;
            max-width: 300px;
        }
        .custom-popup .leaflet-popup-tip-container {
            width: 20px;
            height: 10px;
        }
        .custom-popup .leaflet-popup-tip {
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            box-shadow: none;
        }
        .custom-popup h3 {
            margin: 0 0 12px 0;
            color: #333;
            font-size: 18px;
            font-weight: 600;
        }
        .custom-popup p {
            margin: 0 0 14px 0;
<!--            color: #666;-->
            font-size: 16px;
            line-height: 1.5;
        }
        .custom-popup .popup-info {
            color: #4285f4;
            font-size: 12px;
            margin-top: 10px;
            text-align: center;
        }

        .navbar .container-fluid {
            max-width: 1075px; /* Adjust this value as needed */
        }
    </style>


    <link href="css/carousel.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

</head>
<body>
<svg xmlns="http://www.w3.org/2000/svg" class="d-none">
    <symbol id="check2" viewBox="0 0 16 16">
        <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
    </symbol>
    <symbol id="circle-half" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
    </symbol>
    <symbol id="moon-stars-fill" viewBox="0 0 16 16">
        <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774.258c.346-.115.617-.386.732-.732L13.863.1z"/>
    </symbol>
    <symbol id="sun-fill" viewBox="0 0 16 16">
        <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
    </symbol>
</svg>

<header data-bs-theme="light">
    <nav class="navbar navbar-expand-md navbar-light fixed-top bg-white border-bottom">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
                Urban Mobility Group
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav me-auto mb-2 mb-md-0">
                    <li class="nav-item">
                        <a class="nav-link" href="projects.html">Projects</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="publications.html">Publications</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="presentations.html">Presentations</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="team.html">Team</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="opportunities.html">Opportunities</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="news.html">News</a>
                    </li>

                </ul>
                <form class="d-flex" role="search">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-primary" type="submit">Search</button>
                </form>
            </div>
        </div>
    </nav>
</header>

<main>

    <div id="myCarousel" class="carousel slide mb-6" data-bs-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <div class="container">
                    <div class="carousel-caption text-start">
                        <h1>Redefining Variability</h1>
                        <p class="opacity-75">EvALuating Land Use and TRansport Impacts on Urban Mobility PatternS (realTRIPS)</p>
                        <p><a class="btn btn-lg btn-outline-light" href="about.html">Explore research areas</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="container marketing">
        <div class="row">
            <div class="col-md-12" style="position: relative;">
                <div id="map"></div>

                <div class="controls" style="
            position: absolute;
            left: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 1000;
            flex-direction: column;
            white-space: nowrap;
        ">
                    <label style="">
                        <input type="radio" name="mode" value="SIP_bi" checked>
                        <span style="margin-left: 5px;">Bicycle</span>
                    </label>
                    <label style="">
                        <input type="radio" name="mode" value="SIP_car">
                        <span style="margin-left: 5px;">Car</span>
                    </label>
                    <label>
                        <input type="radio" name="mode" value="SIP_pt">
                        <span style="margin-left: 5px;">Public Transport</span>
                    </label>
                </div>
                <div class="controls" style="
                        position: absolute;
                        left: 320px;
                        background-color: rgba(255, 255, 255, 0.8);
                        z-index: 1000;
                        display: flex;
                        flex-direction: row;
                        white-space: nowrap;
                        padding: 10px;
                        border-radius: 4px;
                        gap: 15px;
                    ">
                    Potential for social interaction:
                    <label style="display: flex; align-items: center;">
                        <span style="width: 15px; height: 15px; background: red; display: inline-block; margin-right: 5px;"></span>
                        <span>High</span>
                    </label>
                    <label style="display: flex; align-items: center;">
                        <span style="width: 15px; height: 15px; background: orange; display: inline-block; margin-right: 5px;"></span>
                        <span>Medium</span>
                    </label>
                    <label style="display: flex; align-items: center;">
                        <span style="width: 15px; height: 15px; background: green; display: inline-block; margin-right: 5px;"></span>
                        <span>Low</span>
                    </label>
                </div>

            </div>
        </div>
        <p class="mt-2">Hover your mouse over a neighbourhood to see potential for social interaction with residents of nearby neighbourhoods — how easy is it to meet up with other urban residents by various modes of transportation?
        </p>
        <hr class="featurette-divider">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h3 class="fw-normal lh-2">Urban Mobility Research Group @ <a href="https://www.ucl.ac.uk/bartlett/casa/">CASA UCL</a>
                    </h3>
                    <p>We study the rhythms of city life through the digital footprints people leave behind. Our work combines human mobility data, GeoAI, and spatial simulations to explore urban change, assess policy impacts, and support the planning of sustainable and inclusive futures in global cities.</p>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5 class="fw-normal lh-2 mt-3">Emerging Human Location Data</h5>
                    <p>We focus on analysing individual-level human mobility data—including travel card records, mobile phone data, and geolocated social media—to gain nuanced insights into how people move through and interact with urban environments.

                    </p>
                </div>
                <div class="col-md-4">
                    <h5 class="fw-normal lh-2 mt-3">Cutting-Edge GeoAI Methods</h5>
                    <p>Drawing from spatial data science, machine learning, deep learning, spatial network analysis, and causal inference, we develop innovative analytical frameworks and simulation models to detect mobility patterns, predict demand, and model urban futures.
                    </p>
                </div>
                <div class="col-md-4">
                    <h5 class="fw-normal lh-1 mt-3">City Planning Scenarios
                    </h5>
                    <p>Our case studies span diverse urban contexts—including London, Shenzhen, and Nairobi. Addressing pressing urban challenges, we are particularly focused on socio-spatial inequality, transport decarbonisation, and the evolution of urban spatial structure.</p>
                </div>
            </div>
        </div>
        <p class="featurette-divider">

        <div class="row featurette">
            <div class="col-md-6" id="news-container">
            </div>
            <div class="col-md-6" id="news-with-image-container">
            </div>
        </div>

        <p class="featurette-divider">

        <div class="row featurette">
            <div class="col-md-12 order-md-1" id="publications-container">
            </div>
        </div>

        <p class="featurette-divider">

        <div class="row featurette">
            <div class="col-md-6 order-md-2" id="presentations-container">
            </div>
            <div class="col-md-6 order-md-1" id="presentations-with-image-container">
            </div>
        </div>

        <hr class="featurette-divider">

    </div><footer class="container">
    <p class="float-end"><a href="#">Back to top</a></p>
    <p>&copy; 2025 Urban Mobility Group, &middot; <a href="#">Contact</a></p>
</footer>
</main>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $(document).ready(function() {
        let regionPairs = [];

        fetch('data/SIP_CASA_0613_large.json')
            .then(response => response.json())
            .then(data => {
                regionPairs = data;
            })
            .catch(error => console.error('Error loading region pairs:', error));

        const mapCenter = [51.5220166, -0.136012];
        var map = L.map('map', {
            zoomControl: true,      // Remove zoom control buttons
            scrollWheelZoom: false,  // Disable zooming with the mouse wheel
            doubleClickZoom: false,  // Disable zooming on double-click
            touchZoom: false,        // Disable touch-based zooming
            boxZoom: false           // Disable zooming with box selection
        }).setView(mapCenter, 14);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/attributions">CartoDB</a>'
        }).addTo(map);


        // --- Custom Marker and Popup ---
        const customMarkerIcon = L.divIcon({
            className: 'custom-marker',
            html: `<div class="marker"><div class="pulse"></div></div>`,
            iconSize: [20, 20],
            iconAnchor: [10, 10]
        });

        const popupContent = `
            <h3>UCL Centre for Advanced Spatial Analysis (CASA)</h3>
            <p><strong>Address: </strong>90 Tottenham Court Road, London, W1T 4TJ</p>
        `;

        L.marker(mapCenter, { icon: customMarkerIcon })
            .addTo(map)
            .bindPopup(popupContent, { className: 'custom-popup' });


        function getColor(value) {
            if (value < 0.1) return 'lightblue';
            if (value < 0.3) return 'lightgreen';
            if (value < 0.6) return 'yellow';
            if (value < 0.9) return 'orange';
            return 'red';
        }

        let geojsonLayer;
        fetch('data/small_london.geojson')
            .then(response => response.json())
            .then(data => {
                if (data.features && data.features.length > 0) {
                    geojsonLayer = L.geoJSON(data, {
                        style: function (feature) {
                            return {
                                fillColor: 'lightblue',
                                color: 'gray',
                                weight: 0.5,
                                opacity: 0.8,
                                fillOpacity: 0.1
                            };
                        }
                    }).addTo(map);

                    function highlightTargetRegion(sourceRegionCode) {
                        const selectedMode = getSelectedMode();
                        const connectedTargets = new Set();
                        regionPairs.forEach(pair => {
                            if (pair.source === sourceRegionCode) {
                                connectedTargets.add(pair.target);
                            }
                        });

                        geojsonLayer.eachLayer(function (layer) {
                            const regionId = layer.feature.properties.lsoa21cd;
                            if (connectedTargets.has(regionId)) {
                                const regionPair = regionPairs.find(pair => pair.source === sourceRegionCode && pair.target === regionId);
                                const value = regionPair ? regionPair[selectedMode] : 0;

                                const color = getColor(value);

                                layer.setStyle({
                                    fillColor: color,
                                    weight: 1,
                                    fillOpacity: 0.5
                                });
                            } else {
                                layer.setStyle({
                                    fillColor: 'lightblue',
                                    weight: 1,
                                    fillOpacity: 0.3
                                });
                            }
                        });
                    }

                    function resetHighlight() {
                        geojsonLayer.eachLayer(function (layer) {
                            layer.setStyle({
                                fillColor: 'lightblue',
                                weight: 1,
                                fillOpacity: 0.3
                            });
                        });
                    }

                    geojsonLayer.on('mouseover', function (event) {
                        const regionCode = event.layer.feature.properties.lsoa21cd;
                        highlightTargetRegion(regionCode);
                    });

                    geojsonLayer.on('mouseout', resetHighlight);

                    const radioButtons = document.querySelectorAll('input[name="mode"]');
                    radioButtons.forEach(button => {
                        button.addEventListener('change', updateMapColors);
                    });

                    function updateMapColors() {
                        const selectedMode = getSelectedMode();
                        if (!selectedMode) return;

                        geojsonLayer.eachLayer(function (layer) {
                            const regionCode = layer.feature.properties.lsoa21cd;
                            let value = 0;

                            const regionPair = regionPairs.find(pair => pair.source === regionCode || pair.target === regionCode);
                            if (regionPair) {
                                value = regionPair[selectedMode];
                            }

                            const color = getColor(value);

                            layer.setStyle({
                                fillColor: color,
                                weight: 2,
                                fillOpacity: 0.6
                            });
                        });
                    }

                    function getSelectedMode() {
                        const selectedRadio = document.querySelector('input[name="mode"]:checked');
                        return selectedRadio ? selectedRadio.value : 'SIP_bi';
                    }
                } else {
                    console.error('GeoJSON data is empty or invalid.');
                }
            })
            .catch(error => console.error('Error loading GeoJSON: ', error));


            // main content
            const newsUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR8irgbaVQD_l9mxchyzISr1fRAmoDHX1ETBc2-OarO79JiZRl-SzesWxyxe4D0b8-r1b1iHbDB1Q_S/pub?output=tsv';
            const publicationsUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQRgLVjhKj9bGisYFNxW_AqvyfYQh4_3JsitOB8XRiwdX1tdBtwzq2MKKyY9a9sm8eltKqeqSLcRRYr/pub?output=tsv';
            const presentationsUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTORqQ0IKcLNuulWcYKABBCvMubmEgNVGXmuHYP-jFz_BGxGw2jkhcaFYlC8AJ7dzk8DJPcMKYwlPhG/pub?output=tsv';
            function GenerateImageDirect(url){

                    const fileIdMatch = url.match(/(?:id=|\/d\/)([\w-]+)/); // Extract file ID
                    const fileId = fileIdMatch ? fileIdMatch[1] : null;
                    if (fileId) {
                        return `https://lh3.googleusercontent.com/d/${fileId}=s4000?authuser=0`;
                    }
                    return 'default_image_url.jpg'; // Fallback URL for missing images
            }
            function createNewsDetailLink(rawDateString) {
                // Step 1: Parse the date string into a Date object
                const dateObj = new Date(rawDateString);

                // Step 2: Convert to ISO format without milliseconds and encode it
                const isoString = dateObj.toISOString().split('.')[0]; // e.g., "2025-04-04T15:39:37"
                const encoded = encodeURIComponent(isoString);

                // Step 3: Construct final URL
                return `news-details.html?timestamp=${encoded}`;
            }
            function generatePresentationHTML(data, allLink = "#") {
                let html = '<div class=""><h5>Latest Presentations</h5><hr>\n';

                let skippedFirstImage = false;
                let count = 0;

                for (let i = 0; i < data.length; i++) {
                    const item = data[i];

                    // Skip the first item with an image
                    if (item.Image && item.Image.trim() !== '' && !skippedFirstImage) {
                        skippedFirstImage = true;
                        continue;
                    }

                    html += `    <h6 class="fw-normal lh-1"><a href="${escapeHtml(item.Link || '#')}" target="_blank">${escapeHtml(item.Title)}</a></h6>\n`;
                    html += `    <p>${escapeHtml(item['Conference name'])}</p>\n`;
                    count++;

                    if (count === 3) {
                        html += '    <hr>\n';
                        html += `    <a href="${allLink}">See all presentations</a>\n`;
                        html += '</div>';
                        return html;
                    }
                }

                // If fewer than 3 items found
                html += '    <hr>\n';
                html += `    <a href="${allLink}">See all presentations</a>\n`;
                html += '</div>';
                return html;
            }


            function generateNewsHTML(data, allLink = "#") {
                let html = '<div class=""><h5>Latest News</h5><hr>\n';

                let skippedFirstImage = false;
                let count = 0;

                for (let i = 0; i < data.length; i++) {
                    const item = data[i];

                    // Skip the first item with an image
                    if (item.Image && item.Image.trim() !== '' && !skippedFirstImage) {
                        skippedFirstImage = true;
                        continue;
                    }

                    html += `    <h6 class="fw-normal lh-1"><a href="${createNewsDetailLink(item.Timestamp)}" target="_blank">${escapeHtml(item.Headline)}</a></h6>\n`;
                    html += `    <p>${escapeHtml(item.Body).substring(0, 130)}...</p>\n`;
                    count++;

                    if (count === 3) {
                        html += '    <hr>\n';
                        html += `    <a href="${allLink}">See all news</a>\n`;
                        html += '</div>';
                        return html;
                    }
                }

                // If fewer than 3 items found
                html += '    <hr>\n';
                html += `    <a href="${allLink}">See all news</a>\n`;
                html += '</div>';
                return html;
            }


       function generateNewsWithImageHTML(data) {
            if (!data || data.length === 0) return;

            // Find the first item that has an Image property
            const item = data.find(item => item.Image && item.Image.trim() !== '');

            // If no item with image is found, return nothing
            if (!item) return;
            // Generate the HTML for the news item with image
            const imageSrc = item.Image ? GenerateImageDirect(item.Image) : 'placeholder.jpg';

            const html = `
                <div class="">
                    <img src="${imageSrc}" alt="" class="img-fluid mb-2" style="width: 100%; height: 300px; object-fit: cover;">
                    <h6 class="fw-normal lh-1">
                        <a href="${createNewsDetailLink(item.Timestamp)}" target="_blank">${escapeHtml(item.Headline)}</a>
                    </h6>
                    <p>${escapeHtml(item.Body).substring(0, 130)}...</p>
                </div>
            `;

            return html;
        }
         function generatePresentationWithImageHTML(data) {
            if (!data || data.length === 0) return;

            // Find the first item that has an Image property
            const item = data.find(item => item.Image && item.Image.trim() !== '');

            // If no item with image is found, return nothing
            if (!item) return;

            // Generate the HTML for the presentation item with image
            const imageSrc = item.Image ? GenerateImageDirect(item.Image) : 'placeholder.jpg';

            const html = `
                <div class="">
                    <img src="${imageSrc}" alt="" class="img-fluid mb-2" style="width: 100%; height: 300px; object-fit: cover;">
                    <h6 class="fw-normal lh-1">
                        <a href="${escapeHtml(item.Link || '#')}" target="_blank">${escapeHtml(item.Title)}</a>
                    </h6>
                    <p>${escapeHtml(item['Conference name'])}</p>
                </div>
            `;

            return html;
         }

        function generatePublicationHTML(data, allLink = "#") {
                let html = '<div class=""><h5>Latest Publications</h5><hr>\n';

                data.forEach(item => {
                    html += `    <h6 class="fw-normal lh-1"><a href='${escapeHtml(item.Link)}' target="_blank">${escapeHtml(item.Title)}</a></h6>\n`;
                    html += `    <p><em>${escapeHtml(item.Authors)}</em> (${escapeHtml(item.Year)})</p>\n`;
                });

                html += '    <hr>\n';
                html += `    <a href="publications.html">See all publications</a>\n`;
                html += '</div>';

                return html;
            }

            // Helper to safely escape HTML special characters (to prevent injection)
            function escapeHtml(text) {
                return text
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            }

            function parseTSV(tsvData) {
                const lines = tsvData.trim().split('\n');
                const headers = lines[0].split('\t').map(h => h.trim());
                const jsonData = [];

                for (let i = 1; i < lines.length; i++) {
                    if (lines[i].trim() === '') continue;
                    const values = lines[i].split('\t');
                    const row = {};
                    headers.forEach((header, idx) => {
                        row[header] = values[idx] || '';
                    });
                    if (row['Active']?.toLowerCase() === 'yes') {
                        jsonData.push(row);
                    }
                }

                // Sort by timestamp (assuming 'Timestamp' column exists and is ISO or parseable format)
                jsonData.sort((a, b) => new Date(b['Timestamp']) - new Date(a['Timestamp']));

                // Return only the newest 3
                return jsonData;
            }


            // Sequential chain with correct function calls
            $.get(newsUrl).then(tsv => {
                const newsData = parseTSV(tsv);
                const newsItems = generateNewsHTML(newsData, "news.html");
                const newsWithImageItems = generateNewsWithImageHTML(newsData);
                $('#news-container').append(newsItems);
                $('#news-with-image-container').append(newsWithImageItems);
            }).then(() => {
                return $.get(publicationsUrl).then(tsv => {
                    const pubData = parseTSV(tsv);
                    const pubItems = generatePublicationHTML(pubData.slice(0, 3), "publications.html");
                    $('#publications-container').append(pubItems);
                });
            }).then(() => {
                return $.get(presentationsUrl).then(tsv => {
                    const presData = parseTSV(tsv);
                    const presItems = generatePresentationHTML(presData, "presentations.html");
                    const presWithImageItems = generatePresentationWithImageHTML(presData);
                    $('#presentations-container').append(presItems);
                    $('#presentations-with-image-container').append(presWithImageItems);
                });
            }).fail((xhr, status, error) => {
                console.error("TSV fetch failed:", status, error);
            });


    }); // end of document ready
</script>

</body>
</html>
